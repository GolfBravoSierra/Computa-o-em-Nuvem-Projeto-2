<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Compilador C em Nuvem Local</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f9;
        }
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 10px;
            box-sizing: border-box;
            font-family: monospace;
            font-size: 14px;
            border: 1px solid #ccc;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
            font-size: 14px;
        }
        button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #e9ecef;
            padding: 10px;
            border: 1px solid #ddd;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Execução de Código C em VM (Localhost:8080)</h1>

    <form id="code-form">
        <label for="prog-name">Nome do Programa:</label>
        <input type="text" id="prog-name" name="prog_name" placeholder="ex: meu_teste" required>

        <label for="code-input">Insira seu Código C:</label>
        <textarea id="code-input" name="c_code">#include <stdio.h>

int main() {
    printf("Olá, Projeto Cloud!\\n");
    return 0;
}</textarea>

        <button type="submit">Compilar e Executar</button>
    </form>

    <h2>Resultado da Execução:</h2>
    <div id="status-output"></div>
    <pre id="stdout-output"></pre>
    <pre id="stderr-output" class="error"></pre>
    <div id="time-output"></div>

    <script>
        document.getElementById('code-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const codeInput = document.getElementById('code-input').value;
            const progName = document.getElementById('prog-name').value;
            const statusOutput = document.getElementById('status-output');
            const stdoutOutput = document.getElementById('stdout-output');
            const stderrOutput = document.getElementById('stderr-output');
            const timeOutput = document.getElementById('time-output');

            // Limpa saídas antigas
            statusOutput.innerHTML = 'Processando...';
            stdoutOutput.textContent = '';
            stderrOutput.textContent = '';
            timeOutput.textContent = '';

            // Prepara o corpo da requisição
            const formData = new FormData();
            formData.append('c_code', codeInput);
            formData.append('prog_name', progName);

            // Envia ao backend Flask
            fetch('/execute', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                statusOutput.innerHTML = `Status: <span class="${data.status === 'Success' ? 'success' : 'error'}">${data.status}</span>`;
                if (data.stdout) {
                    stdoutOutput.textContent = 'STDOUT:\n' + data.stdout;
                }
                if (data.stderr) {
                    stderrOutput.textContent = 'STDERR:\n' + data.stderr;
                }
                if (data.time_elapsed_wall) {
                    timeOutput.textContent = `Tempo de Execução: ${data.time_elapsed_wall}`;
                }
            })
            .catch(error => {
                statusOutput.innerHTML = `<span class="error">Erro de Comunicação: ${error.message}</span>`;
                console.error('Fetch error:', error);
            });
        });
    </script>
</body>
</html>
